<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<div class="flex-grid" id="stats" style.display:none;>
	<button class = "next_turn" onclick = "displaypopup(1,confirmation)">Main Menu</button>
	<div id = "pop" class = "pop">Population: 0/0</div>

	<div id = "food">Food: 0</div>
	<div id = "power">Military: 0</div>
		<div id = "unemployed" class = "pop">Unemployed People: 0</div>
		<div id = "resources" class = "pop">Resources: 10</div>
	<button class = "next_turn" id = "turn" onclick = "next_turn()">End Year</button>
	<button class = "next_turn" onclick = "savescreen(true)">SAVE</button>
	<button class = "info" onclick = "achievementscreen(false)">Achievements</button>
	<button class = "info" onclick = "info()">Building Info</button>
	<button class = "info" onclick = "marketscreen()">Market</button>
	
	


		
</div>
<h1 class = "title_screen" id = "title_start">Civilization</h1>
<div id ="info-flex" class = 'info-flex'></div>
<div id ="achievement-flex" class =  'achievement-flex'>
<h1 style = "text-align:center">Achievements:</h1>
</div>
<canvas id="canvas" width="1500" height="500" id="canvas"></canvas>

<div class="select-grid" id="select-grid" hidden = true>
<button class = 'cancel' onclick = "cancel()">Cancel</button>
</div>


<div class = "start-box" id = "start-flex">
	
	<button id = "start" class = "start_button" onclick = "difficultyscreen()">New Game</button>
	<button id = "start" class = "start_button" onclick = "savescreen(false)">Load Game</button>
	<button id = "start" class = "start_button" onclick = "achievementscreen(true)">Achievements</button>
</div>
<div class = "save-flex" id = 'save-flex'>
	<div class = "save-grid" id = "save-grid1">
		<h1>Save Slot 1:</h1>
		<p class= "savedes1"> Empty Slot</p>
		<button id = "1" class = "save_button" onclick = "savegame(1)">Save Game</button>
		<button id = "clear1" class = "clear_button" onclick = "clearsave(1)">Clear Save</button>
	 </div>
	 <div class = "save-grid" id = "save-grid2">
		<h1>Save Slot 2:</h1>
		<p class= "savedes2"> Empty Slot</p>
		<button id = "2" class = "save_button" onclick = "savegame(2)">Save Game</button>
		<button id = "clear2" class = "clear_button" onclick = "clearsave(2)">Clear Save</button>
	 </div>
	 <div class = "save-grid" id = "save-grid3">
		<h1>Save Slot 3:</h1>
		<p class= "savedes3"> Empty Slot</p>
		<button id = "3" class = "save_button" onclick = "savegame(3)">Save Game</button>
		<button id = "clear3" class = "clear_button" onclick = "clearsave(3)">Clear Save</button>
	 </div>
	 <div class = "save-grid" id = "save-grid4">
		<h1>Save Slot 4:</h1>
		<p class= "savedes3"> Empty Slot</p>
		<button id = "4" class = "save_button" onclick = "savegame(4)">Save Game</button>
		<button id = "clear4" class = "clear_button" onclick = "clearsave(4)">Clear Save</button>
	 </div>
	 <div class = "save-grid" id = "save-grid5">
		<h1>Save Slot 5:</h1>
		<p class= "savedes5"> Empty Slot</p>
		<button id = "5" class = "save_button" onclick = "savegame(5)">Save Game</button>
		<button id = "clear5" class = "clear_button" onclick = "clearsave(5)">Clear Save</button>
	 </div>
 </div>
 <div class = "achievement-unlocked" id = "unlocked">
 <p style = "font-weight:bold; font-size:15px;">Achievement Unlocked:</p>
 <p id = "achievementname"></p>
 </div>
 <div class = "difficulty-flex" id = 'difficulty-flex'>
 	<div class = "save-grid" id = "save-grid1">
		<h1 strong class = 'color-g'>Copper:</h1>
		<p>Favorable events happen more frequently</p>
		<p>Rebellions happen less frequently</p>
		<p>+50% production</p>
		<p>x0.5 enemy strength</p>
		<button id = "1" class = "new_button" onclick = "newgame(1)">New Game</button>
	 </div>
	 <div class = "save-grid" id = "save-grid2">
		<h1 strong class = 'color-y'>Iron:</h1>
		<p>Favorable events have same frequency as unfavorable events</p>
		<p>Rebellions happen at normal frequency</p>
		<p>Normal production</p>
		<p>Normal enemy strength</p>
		<button id = "2" class = "new_button" onclick = "newgame(1.5)">New Game</button>
	 </div>
	 <div class = "save-grid" id = "save-grid3">
		<h1 strong class = 'color-r'>Diamond:</h1>
		<p>Unfavorable events happen more frequently</p>
		<p>Rebellions happen more frequently</p>
		<p>-50% production</p>
		<p>x1.5 enemy strength</p>
		<button id = "3" class = "new_button" onclick = "newgame(2)">New Game</button>
	 </div>
 </div>

 <button class = "back_button" id = "back_button" hidden>Back</button>
<div class = "popup_block_buttons" id = "popup_block_buttons"></div>
<div class = "popup" id = "popup">
	<div id = "title" class = "title">undefined</div><br></br>
	
	<div id = "description" class = "dis">undefined</div>
</div>
<div style = "display: none; align-items: center; flex-direction: column; position: absolute; bottom: 80%; width: 100%;" id = market-flex>
<h1 class = "title_screen">Market</h1>
<div class = "market-ui"></div>

<h1 class = "title_screen">Black Market</h1>
<div class = "market-ui"></div>
</div>
<style>
.market-ui{
	display: flex;
	align-items: center;
	width: 80%;
	border: 3px solid #000000;
  border-radius: 6px;
}
@keyframes done{
	from    { opacity: 1; }
	to   { opacity: 0; }

}

.difficulty-flex{

display: none;
	width: 70%;
	
	position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%)
}
.info-flex{
	display:flex;
	width: 100%;
	flex-wrap: wrap;

}
strong{
	font-weight: normal;
}

.achievement-unlocked{
	display: none;
		flex-direction: column;

	align-items: center;
	position: absolute;
  top: 90%;
  left: 50%;
  transform: translate(-50%, -90%);
	width: 20%;
	animation-fill-mode: forwards;
	background-color: #e9edaf;
	animation-name: done;
  animation-duration: 4s;
border: 3px solid #000000;
  border-radius: 6px;
  
}
.achievement-flex{
	display:none;
	width: 100%;
	flex-direction: column;
	gap: 50px;
	flex-wrap: wrap;
	
}
.achievement-container{
background-color: #e9edaf;
border: 3px solid #000000;
  border-radius: 6px;
}

.save-flex{
	display: none;
	width: 70%;
	gap:15px;
	position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.save-grid{
	width: 180px;
	margin: auto;
	display:grid;
	background-color: #e9edaf;
	grid-template-rows: 100px 62.5px 62.5px 62.5px 62.5px 150px 50px;
	
  text-align: center;
  border: 3px solid #000000;
  border-radius: 6px;
	
}
.popup_block_buttons{
	display: none;
	position: absolute;
	bottom: 5px; 
	
	
}
.info-grid{
	display: flex;
	width: 15%;
	flex-direction: column;
	border: 3px solid #000000;
  border-radius: 6px;
}
.color-r{
	color: #ff0000;
}
.color-y{
	color: yellow;
}
.color-g{
	color: green;
}
.color-dg{
	color: #006300;
}
.title_screen{
	margin: auto;
	text-align: center;
	
	
	font-size: 50px;
	color: #b8942a;

}
.clear_button{
margin: auto;
	font-size: 20px;
	width: 120px;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	grid-row:7;
	
}
.clear_button:hover:enabled{
	background-color: #8c6c0b;
}
.save_button{
margin: auto;
	font-size: 20px;
	width: 120px;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	grid-row:6;
	
}
.save_button:hover:enabled{
	background-color: #8c6c0b;
}
.new_button{
margin: auto;
	font-size: 20px;
	width: 120px;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	grid-row:6;
	
}
.new_button:hover:enabled{
	background-color: #8c6c0b;
}
.select-choice{
	transition-duration: 0.1s;
	background-color: #f0e87a;
}
.select-choice:hover:enabled{
		background-color: #8c6c0b;

}
.cancel{
	transition-duration: 0.1s;
	background-color: #f0e87a;
}
.cancel:hover:enabled{
		background-color: #8c6c0b;

}
.start_button{
	margin: auto;
	font-size: 30px;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	
}
.start_button:hover{
	background-color: #8c6c0b;
}
.back_button{
	
	position: fixed;
	top: 95%;
  left: 50%;
  transform: translate(-50%, -95%);
	font-size: 30px;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	
}
.back_button:hover{
	background-color: #8c6c0b;
}

.next_turn{
	border-radius: 2px;
	
	transition-duration: 0.1s;
	background-color: #f0e87a;
	
}
.info:hover{
	background-color: #8c6c0b;
}
.info{
	margin-left: auto;
	border-radius: 2px;
	
	transition-duration: 0.1s;
	background-color: #f0e87a;
	
}
.next_turn:hover{
	background-color: #8c6c0b;
}
.start-box{
	display: flex;
	flex-direction: column;
	position: absolute;
	gap: 20px;
	top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
body{
	background-color:#fff8dc;
	overflow: hidden;
	font-family: Arial, Helvetica, sans-serif;
	user-select: none;
}
.pop{
	white-space: nowrap;
}
.dis {
	margin:auto;
	text-align: center;
  grid-row: 2;
}
.popup_choice {
	margin:auto;
	border-style: solid;
	border-radius: 6px;
	transition-duration: 0.1s;
	background-color: #f0e87a;
	font-weight: bold;
	width: 90px;
	height: 40px;
	
}
.popup_choice:hover:enabled{
	background-color: #bfb965;
}

.title {
	margin:auto;
	font-size: 30px;
	text-align: center;
  grid-row: 0;
}
.flex-grid {
	height: 50px;
	border-style: solid;
	border-radius: 6px;
  display: none;
  gap: 1px;
  flex-wrap: nowrap;
  

}
.select-grid{
position: absolute;
top:93%;
	height: 50px;
	border-style: solid;
	border-radius: 6px;
  display: none;
  gap: 1px;
  flex-wrap: nowrap;
  
}
.flex-grid > div {
  margin: 10px;
  text-align: center;
}.select-grid > div {
  margin: 10px;
  text-align: center;
}

.popup{
	background-color: #966F33 ;
	width: 400px;
	height: 300px;
	border-style: solid;
	border-radius: 6px;
	display: none;
	justify-content: center;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  flex-wrap: nowrap;
}
</style>
<script>
const canvas = document.querySelector("canvas")
canvas.height = screen.height-225
canvas.width = screen.width
const ctx = canvas.getContext("2d")
const heightmax = Math.round((screen.height-225)/20)
const widthmax = Math.round((screen.width)/20)
const rivergrid = [] 

const grid = []

const hillgrid = [] 


const gridstats = []

let ispainting = false
let position = {}
let letter = ""
let piece = []
let population = 0
let food = 0
let resources = 8
let resourcesgained = 0
let p_index = 0
let removeindex = [];
let modifiers = {
	food: 0,
	resources:0,
	military:0
}

let punishamount = 0
let allowed = true;
let military = 0;
let currentpop = 2;
let istutorial = false;
let tutorialindex = 0;
let disableinfo = false
let unemployed = 2;
let difficulty = 0;
let first_turn = true;
let luck = 0
let lockdown = false;
let lockdowntimer = 0;
let save_slot = null;
let difficultymultiplier = 0
const choicesdisabled = []
const buildingamounts = []
savewidths = document.getElementsByClassName("save-grid")
debugger
for (const el of savewidths){
el.style.gridTemplateRows = `${100*(screen.height/900)}px ${62.5*(screen.height/900)}px ${62.5*(screen.height/900)}px ${62.5*(screen.height/900)}px ${62.5*(screen.height/900)}px ${150*(screen.height/900)}px ${50*(screen.height/900)}px`
}
function marketscreen(){
	
	document.getElementById("difficulty-flex").style.display = 'none'
	document.getElementById("market-flex").style.display = 'flex'
	document.getElementById("back_button").hidden = false
	document.getElementById("back_button").onclick = function(){start()}
	document.getElementById("stats").style.display = "none"
	document.getElementById("select-grid").style.display = "none"
	ctx.clearRect(0,0,screen.width,screen.height)
	document.getElementById("save-flex").style.display = "none"
}
function info(){
	document.body.style.overflow = "scroll"
ispainting = false
	const ele = document.getElementsByClassName("infotext")
	for (let j=ele.length-1;j>=0;j--){
		ele[j].remove();
	}
	const ele2 = document.getElementsByClassName("info-grid")
	for (let j=ele2.length-1;j>=0;j--){
		ele2[j].remove();
	}
	document.getElementById("info-flex").style.display = 'flex'
	document.getElementById("difficulty-flex").style.display = 'none'
	document.getElementById("back_button").hidden = false
	document.getElementById("back_button").onclick = function(){start()}
	document.getElementById("stats").style.display = "none"
	document.getElementById("select-grid").style.display = "none"
	ctx.clearRect(0,0,screen.width,screen.height)
	document.getElementById("save-flex").style.display = "none"
	
	for (const building of p.pieceROM){
		const grid = document.createElement("div")
		grid.className = "info-grid"
		const title = document.createElement("h1")
		title.className = "infotext"
		title.innerHTML = building.name
		title.style.textAlign = 'center'
		grid.appendChild(title)
		const des = document.createElement("p")
		des.innerHTML = building.description
		des.style.textAlign = 'center'
		des.className = 'infotext'
		grid.appendChild(des)
		document.getElementById("info-flex").appendChild(grid)
	}
}
function achievementscreen(ismenu){
ispainting = false
	const ele = document.getElementsByClassName("achievement-container")
	for (let j=ele.length-1;j>=0;j--){
		ele[j].remove();
	}
	
	if(ismenu){
	document.getElementById("back_button").onclick = function(){menu()}
	}
	else{
	document.getElementById("back_button").onclick = function(){start()}
	}
	document.body.style.overflow = "scroll"
	document.getElementById("achievement-flex").style.display = 'flex'
	document.getElementById("difficulty-flex").style.display = 'none'
	document.getElementById("back_button").hidden = false
	document.getElementById("title_start").hidden = true
	document.getElementById("start-flex").style.display = "none"
	
	document.getElementById("stats").style.display = "none"
	document.getElementById("select-grid").style.display = "none"
	ctx.clearRect(0,0,screen.width,screen.height)
	document.getElementById("save-flex").style.display = "none"
	for (const el of achievements){
		const flex = document.createElement("flex")
		
		const title = document.createElement("h1")
		const description = document.createElement("p")
		title.innerHTML = el.title
		description.innerHTML = el.description
		flex.className = "achievement-container"
		flex.appendChild(title)
		flex.appendChild(description)
		
		document.getElementById("achievement-flex").appendChild(flex)
		if (!el.acquired){
		
		flex.style.opacity = "0.7"
		title.style.opacity = "0.7"
		description.style.opacity = "0.7"
		flex.style.backgroundColor = "rgb(69, 62, 62)"
		}
	}
	
	
}
function difficultyscreen(){

		const ele = document.getElementsByClassName("new_button")
		let k = 1
		for (const el of ele){
				if (k==2){
					break
				}
				el.innerHTML = "New Game"
				el.disabled = false;
				el.id = k
				el.onclick = function(){newgame(parseFloat(el.id))}
				k+=0.5
			
		}
	document.getElementById("difficulty-flex").style.display = 'flex'
	document.getElementById("back_button").hidden = false
	document.getElementById("back_button").onclick = function(){menu()}
	document.getElementById("title_start").innerHTML = 'Select Difficulty'
	document.getElementById("start-flex").style.display = "none"
}
function clearsave(index){

	confirmation[2].choosetext(index)
	displaypopup(2,confirmation)
}
function menu(){
ispainting = false
document.getElementById("achievement-flex").style.display = 'none'
document.getElementById("difficulty-flex").style.display = 'none'
document.getElementById("title_start").innerHTML = 'Civilization'
	document.getElementById("back_button").hidden = true
	document.getElementById("title_start").hidden = false
	document.getElementById("stats").style.display = "none"
	document.getElementById("start-flex").style.display = "flex"
	document.body.style.overflow = "hidden"
	document.getElementById("select-grid").style.display = "none"
	ctx.clearRect(0,0,screen.width,screen.height)
	document.getElementById("save-flex").style.display = "none"
}
function savescreen(save){
ispainting = false
	document.getElementById("back_button").hidden = false
	const ele2 = document.getElementsByClassName("clear_button")
		i=1
		for (const el of ele2){
		if (localStorage.getItem('grid'+i) == null){
				el.disabled = true;
			}
			else{el.disabled=false}
			i++
		}
	if (!save){
		document.getElementById("back_button").onclick = function(){menu()}
		const ele = document.getElementsByClassName("save_button")
		const ele2 = document.getElementsByClassName("clear_button")
		i=1
		for (const el of ele2){
		if (localStorage.getItem('grid'+i) == null){
				el.disabled = true;
			}
			else {
				el.disabled=false
			}
			i++
		}
		i=1
		for (const el of ele){
			el.innerHTML = "Load Game"
			el.onclick = function(){load(el.id)}
			if (localStorage.getItem('grid'+i) == null){
				el.disabled = true;
			}
			i++
		}
	}
	else{
		
		document.getElementById("back_button").onclick = function(){start()}
		const ele = document.getElementsByClassName("save_button")
		
		i=1
		for (const el of ele){
			el.disabled = false
			el.innerHTML = "Save Game"
			el.onclick = function(){savegame(el.id)}
			i++
		}
	}
	for (i=1;i<6;i++){
		const ele = document.getElementsByClassName("savedes"+i)
			for (let j=ele.length-1;j>=0;j--){
				ele[j].remove();
			}
		if (localStorage.getItem('grid'+i) != null){
			
			const grid = document.getElementById("save-grid"+i)
			difficultyname=""
			switch(localStorage.getItem("multiply"+i)){
				case '1':
				difficultyname = "copper"
				break
				case '1.5':
				difficultyname="iron"
				break
				case '2':
				difficultyname="diamond"
			}
			const informationlist = ["difficulty: "+ difficultyname, "population: " + JSON.parse(localStorage.getItem('population'+i)), "resources: " + JSON.parse(localStorage.getItem('resources'+i)), "military: " + JSON.parse(localStorage.getItem('military'+i))]
			for (let j=0;j<4;j++){
				
				const des = document.createElement("p")
				des.innerHTML = informationlist[j]
				des.className = "savedes"+i
				
				grid.appendChild(des)
			}
		}
		else{
			const grid = document.getElementById("save-grid"+i)

			const des = document.createElement("p")
				des.innerHTML = "Empty Slot"
				des.className = "savedes"+i
				
				grid.appendChild(des)
		}
	}
	document.getElementById("title_start").innerHTML = "Select Save"
	document.getElementById("stats").style.display = "none"
	document.getElementById("start-flex").style.display = "none"
	document.getElementById("select-grid").style.display = "none"
	ctx.clearRect(0,0,screen.width,screen.height)
	document.getElementById("save-flex").style.display = "flex"
	
}
function savegame(bindex){

	confirmation[0].choosetext(bindex)
	displaypopup(0,confirmation)
	
}
function save(bindex){
	const ele = document.getElementsByClassName("savedes"+bindex)
	for (i=ele.length-1;i>=0;i--){
		ele[i].remove();
	}
	

	save_slot = bindex
	localStorage.setItem('grid'+bindex, JSON.stringify(grid));
	localStorage.setItem('river'+bindex, JSON.stringify(rivergrid));
	localStorage.setItem('hill'+bindex, JSON.stringify(hillgrid));
	localStorage.setItem('stats'+bindex, JSON.stringify(gridstats));
	localStorage.setItem('modifiers'+bindex, JSON.stringify(modifiers));
	localStorage.setItem('population'+bindex, currentpop.toString());
	localStorage.setItem('military'+bindex, military.toString());
	localStorage.setItem('resources'+bindex, resources.toString());
	localStorage.setItem('lockdown'+bindex, JSON.stringify(lockdown));
	localStorage.setItem('lockdowntimer'+bindex, JSON.stringify(lockdowntimer));
	localStorage.setItem('difficulty'+bindex, JSON.stringify(difficulty));
	localStorage.setItem('slot'+bindex, JSON.stringify(save_slot));
	localStorage.setItem('multiply'+bindex, JSON.stringify(difficultymultiplier));
	localStorage.setItem('amounts'+bindex, JSON.stringify(buildingamounts));

	document.getElementById("save-flex").style.display = "none"
	start()
}
function load(bindex){
	buildingamounts.length = 0
	rivergrid.length=0
	gridstats.length=0
	grid.length=0
	hillgrid.length=0

	localgrid = JSON.parse(localStorage.getItem('grid'+bindex));
	localriver = JSON.parse(localStorage.getItem('river'+bindex));
	localhill = JSON.parse(localStorage.getItem('hill'+bindex));
	resources = JSON.parse(localStorage.getItem('resources'+bindex));
	localstats = JSON.parse(localStorage.getItem('stats'+bindex));
	localmod = JSON.parse(localStorage.getItem('modifiers'+bindex));
	currentpop = JSON.parse(localStorage.getItem('population'+bindex));
	lockdown = JSON.parse(localStorage.getItem('lockdown'+bindex));
	lockdowntimer = JSON.parse(localStorage.getItem('lockdowntimer'+bindex));
	save_slot = JSON.parse(localStorage.getItem('slot'+bindex));
	difficulty = JSON.parse(localStorage.getItem('difficulty'+bindex));
	difficultymultiplier = JSON.parse(localStorage.getItem('multiply'+bindex));
	localbuildingamounts = JSON.parse(localStorage.getItem('amounts'+bindex));
	if (localstats.length>0){
		first_turn=false
	}
	for (i=0;i!=localgrid.length;i++){
	grid.push(localgrid[i])
	}
	for (i=0;i!=localriver.length;i++){
	rivergrid.push(localriver[i])
	}
	for (i=0;i!=localhill.length;i++){
	hillgrid.push(localhill[i])
	}
	for (i=0;i!=localbuildingamounts.length;i++){
	buildingamounts.push(localbuildingamounts[i])
	}
	modifiers.food = localmod.food
	modifiers.resource = localmod.resources
	modifiers.military = localmod.military
	for (i=0;i!=localstats.length;i++){
	gridstats.push(localstats[i])
	}
	start()
}
function newgame(difficult){
	rivergrid.length=0
	gridstats.length=0
	grid.length=0
	hillgrid.length=0

	buildingamounts.length = 0
	punishamount = 0
	for (i=0;i<p.pieceROM.length;i++){
	buildingamounts.push(0);
}	
	modifiers = {
	food: 1.5-difficult,
	resources: 1.5-difficult,
	military: 1
	}
	first_turn=true
	save_slot=null
	resources = 8
	difficulty = 0
	difficultymultiplier=difficult
	currentpop = 2
	unemployed = 2
	rivergrid.length = 0
	hillgrid.length = 0
	grid.length = 0
	gridstats.length = 0
	for (i=0;i!=heightmax;i++){
	rivergrid.push([])
	}
	for (i=0;i!=heightmax;i++){
		hillgrid.push([])
	}
	for (i=0;i!=heightmax;i++){
		grid.push([])
	}
	for (i=0;i<getRandomInt(1,3);i++){
	generateriver(Math.round(widthmax/2)+getRandomInt(-10,10), 0, getRandomInt(-5,5))
	}
generatehill()
generatehill()
generatehill()
generatehill()
generatehill()
generatehill()
displaypopup(3, confirmation)
}

const achievements = [
	{
		acquired: false,
		title: "Humble Beginnings",
		description: "build your first building",
		requires(){
		return gridstats.length>=1
		}
	},
	{
	acquired: false,
		title: "Small Town",
		description: "build 10 buildings",
		requires(){
		return gridstats.length>=10
		}
	},
	{
	acquired: false,
		title: "Megatropolis",
		description: "build 50 buildings",
		requires(){
		return gridstats.length>=50
		}
	},
	{
	acquired: false,
		title: "UN recognized country",
		description: "build 100 buildings",
		requires(){
		return gridstats.length>=100
		}
	},

	{
	acquired: false,
	title: "First Shelter",
	description: "build your first Tent",
	requires(){
		return buildingamounts[0] > 0
		}
	},
	{
	acquired: false,
	title: "it's settling time",
	description: "build your first House",
	requires(){
		return buildingamounts[1] > 0
		}
	},
	{
	acquired: false,
	title: "Two for the price of two",
	description: "build your first Duplex",
	requires(){
		return buildingamounts[2] > 0
		}
	},
	{
		acquired: false,
		title: "Urbanization",
		description: "build your first Insula",
		requires(){
			return buildingamounts[3] > 0
		}
	},
	{
		acquired: false,
		title: "Country Road take me home",
		description: "build your first Road",
		requires(){
			return buildingamounts[4] > 0
		}
	},
	{
		acquired: false,
		title: "Ant algaculture",
		description: "build your first Tiny Farm",
		requires(){
		return buildingamounts[5] > 0
		}
	},
	
	{
		acquired: false,
		title: "What a hoe",
		description: "build your first Small Farm",
		requires(){
		return buildingamounts[6] > 0
		}
	},
	
	{
		acquired: false,
		title: "It's 3/4 farm",
		description: "build your first Medium Farm",
		requires(){
		return buildingamounts[7] > 0
		}
	},
	
	{
		acquired: false,
		title: "Irrigation",
		description: "build your first Large Farm",
		requires(){
		return buildingamounts[8] > 0
		}
	
	},
	{
		acquired: false,
		title: "Bless me",
		description: "build your first Temple",
		requires(){
		return buildingamounts[9] > 0
		}

	},
	{
		acquired: false,
		title: "The Army!?!",
		description: "build your first Military Base",
		requires(){
		return buildingamounts[10] > 0
		}
	
	},
	{
	acquired: false,
		title: "You and what army?",
		description: "have 1000 military power",
		requires(){
		return military >= 1000
		}
	},
	{
		acquired: false,
		title: "London bridge is falling down",
		description: "build your first Bridge",
		requires(){
		return buildingamounts[11] > 0
		}
	},
	
	{
		acquired: false,
		title: "Mining away",
		description: "build your first Small Mine",
		requires(){
		return buildingamounts[12] > 0
		}
	},
	
	{
		acquired: false,
		title: "So mean",
		description: "build your first Medium Mine",
		requires(){
		return buildingamounts[13] > 0
		}
	},
	{
		acquired: false,
		title: "Cursed",
		description: "???",
		requires(){
		return luck < 0
		}
	},
	{
		acquired: false,
		title: "Industrialization",
		description: "build your first Large Mine",
		requires(){
		return buildingamounts[14] > 0
		}
	},
	{
		acquired: false,
		title: "Efficiency -100",
		description: "build more than 10 tiny farms while only having less than two small farms",
		requires(){
		return buildingamounts[5] > 10 && buildingamounts[6]<2
		}
	},
	{
		acquired: false,
		title: "Hero",
		description: "Give resources to Robin Hood.",
		requires(){
		return false
		}
	},
	{
		acquired: false,
		title: "Conscription",
		description: "Gain 100 military power from unemployed people",
		requires(){
		return unemployed>=100
		}
	},
	{
		acquired: false,
		title: "Dictator",
		description: "Punish revolutionaries 5 times in one game",
		requires(){
		return false
		}
		
	},
	
		
	
]
const acquired = new Array(achievements.length).fill(false);
if (localStorage.getItem("achievements") !=null){
list = JSON.parse(localStorage.getItem("achievements"))
for (i=0;i < achievements.length;i++){
achievements[i].acquired = list[i]
acquired[i] = list[i]
}
}
else{

	localStorage.setItem("achievements", JSON.stringify(acquired))
}
const p = {
	pieceROM: [
	
	{
		name: "Tent",
		letter: "T",
		description: "A small unit of housing that houses 1 person. Requires 1 resource to construct",
		piecepositions:[{x:0,y:0}],
		near: "building",
		effect(){
			p.population=1
			resources-=1
		},
		
		requires(){
			return resources >=1
		}

	},
	{
		name: "House",
		letter: "H",
		description: "A medium unit of housing that houses 4 people. Requires 3 resources to construct",
		piecepositions:[{x:0,y:0}],
		near: "building",
		effect(){
			p.population=4
			resources-=3
		},
		
		requires(){
			return resources >=3 && difficulty>3
		}
	},
	{
		name: "Duplex",
		letter: "D",
		description: "Two conjoined houses. Houses 8 people and requires 5 resources to construct",
		piecepositions:[{x:0,y:0},{x:1,y:0}],
		near: "building",
		effect(){
			p.population=8
			resources-=5
		},
		
		requires(){
			return resources >=6 && difficulty>3
		}
	},
	
	{
		name: "Insula",
		letter: "I",
		description: "A high density primitive apartment that houses 40 people. Requires 20 resources to construct",
		piecepositions:[{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}],
		near: "building",
		effect(){
			p.population=40
			resources-=20
		},
		requires(){
			return resources >= 20 && difficulty>4
		}
	},
	
	{
		name: "Road",
		letter: "R",
		description: "A road that connects one place from the village to another. Requires 0.25 resources to construct",
		piecepositions:[{x:0,y:0}],
		near: "building",
		effect(){
			resources -=0.25
		},
		requires(){
			return resources >= 0.25 &&difficulty>3

		}
	},
	{
		name: "Tiny Farm",
		letter: "TF",
		piecepositions: [{x:1,y:0},{x:0,y:0}],
		description: "A very small farm that produces 2 food. Requires 2 resources to construct",
		near: "building",
		effect(){
			p.food=2
			resources-=2
			
		},
		requires(){
			return resources >= 2 && unemployed >=0
		}
	},
	{
		name: "Small Farm",
		letter: "F",
		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}],
		description: "A small farm that produces 5 food. Requires 2 resources to construct and 1 person operating it",
		near: "building",
		effect(){
			p.food=5
			resources-=3
			unemployed-=1
		},
		requires(){
			return resources >= 3 && unemployed >=1
		}
	},
	{
		name: "Medium Farm",
		letter: "MF",
		description: "A medium farm that produces 20 food. Requires 10 resources to construct and 3 people operating it",
		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}],
		near: "building",
		effect(){
			p.food=20
			resources-=10
			unemployed-=3
		},
		requires(){
			return resources >=20 && unemployed>=6
		}
	},
	{
		name: "Large Farm",
		letter: "LF",
		description: "A large farm that produces 30 food. Requires 20 resources to construct, 5 people operating it and must be nearby a river for irrigation",

		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1},{x:0,y:-1}],
		near: "river",
		effect(){
			p.food=30
			resources-=20
			unemployed-=5
		},
		requires(){
			return resources >=40 && unemployed>=10
		}
	},
	{
		name: "Temple",
		letter: "T",
		description: "A temple to pray to RNGesus (increases luck). Requires 40 resources to construct and 10 people operating it",

		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1},{x:0,y:-1},{x:-1,y:0},{x:-1,y:-1},{x:-1,y:1}],
		near: "building",
		effect(){
			luck+=1
			resources-=40
			unemployed-=10
		},
		requires(){
			return resources>=40 && unemployed>=10
		}
	},
	{
		name: "Military Base",
		letter: "MB",
		description: "A building for military operations that increases military power by 20. Double effectivness if entirely on a hill. Requires 6 resources to construct and 3 people operating it",

		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}],
		near: "building",
		effect(){
			p.military=10
			resources-=6
			unemployed-=3
			p.hill = true
		},
		requires(){
			return resources >= 6 && unemployed>=3
		}
		
	},
	{
		name: "Bridge",
		letter: "B",
		description: "A brige to connect one side of the river to another. Must be on a river to construct and requires 3 resources",

		piecepositions: [{x:0,y:0}],
		near: "building",
		effect(){
			resources-=3
		},
		requires(){
			return resources >= 3&&difficulty>4
		}
		
	},
	{
		name: "Small Mine",
		letter: "SM",
		description: "A small mine to extract resources from a hill. Collects 3 resources per year. Must be on a hill and requires 3 resources and 1 person operating it",

		piecepositions: [{x:0,y:0},{x:0,y:1}],
		near: "hill",
		effect(){
			
			p.resources=3
			resources-=3
			unemployed-=1
		},
		requires(){
			return resources >=3 && unemployed>=1
		}
	},
	{
		name: "Medium Mine",
		letter: "MM",
		description: "A medium mine to extract resources from a hill. Collects 12 resources per year. Must be on a hill and requires 12 resources and 3 people operating it",
		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1}],
		near: "hill",
		effect(){
			p.resources=14
			resources-=12
			unemployed-=3
		},
		requires(){
			return resources >=12 && unemployed>=3&&difficulty>4
		}
	},
	{
		name: "Large Mine",
		letter: "LM",
		description: "A large mine to extract resources from a hill. Collects 30 resources per year. Must be on a hill and requires 25 resources and 8 people operating it",
		piecepositions: [{x:1,y:0},{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1},{x:0,y:-1}],
		near: "hill",
		effect(){
			p.resources=30
			resources-=25
			unemployed-=8
		},
		requires(){
			return resources >=25 && unemployed>=8
		}
	},

],
food:0,
population:0,
military:0,
resources:0,
river: false,
hill : false
}
function continuetutorial(index){
	displaypopup(index, tutorial)
}
const tutorial = [
{
	title: "Tutorial",
	size: "30px",
	
	
	description: 'This is a game about civilization building, where you, as the ruler, must manage your food and resources to build the empire of your dreams.',
	choices: [
	{
		text: "okay",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			tutorialindex+=1
			continuetutorial(tutorialindex)
		},
	},
	
	]
	},
	{
	title: "Tutorial",
	size: "30px",
	
	
	description: 'To get started, place down a small mine. The small mine will produce resources, but must be on a hill. You can do this by clicking the "Small Mine" button and moving your mouse to the desired location. Afterwards, click again to place it.',
	choices: [
	{
		text: "okay",
		effect(){
			
			for (const el of document.getElementsByClassName("select-choice")){
				if (el.innerHTML!="Small Mine"){
					el.disabled=true
				}
			}
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		},
	},
	
	]
	},
	{
	title: "Tutorial",
	size: "30px",
	
	
	description: 'Great! Next, place down a small farm. After your first turn, buildings must be placed ajacent to each other.',
	choices: [
	{
		text: "okay",
		effect(){
			
			
			for (const el of document.getElementsByClassName("select-choice")){
				if (el.innerHTML!="Small Farm"){
					el.disabled=true
				}
			}
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		},
	},
	
	]
	},
	{
	title: "Tutorial",
	size: "30px",
	
	
	description: 'Perfect! Now click "End year". Keep in mind that you must place down these two buildings first turn to progress',
	choices: [
	{
		text: "okay",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		},
	},
	
	]
	},
	{
	title: "Tutorial",
	size: "30px",
	
	
	description: 'Nice! Now you are ready to play this game. To see the resource requirement for each building, click on the "building info" button on the top right corner, which will show the costs and effects of each building. And click on the achievements button to see which have you earned',
	choices: [
	{
		text: "okay",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			disableinfo = false
			displayUI()
		},
	},
	
	]
	},
	{
		title: "<strong class = 'color-r>Housing</strong>",
	size: "30px",
	
	
	description: 'Remember to build housing for your citizens after turn 5 (7.5 on iron and 10 on diamond), otherwise they will rebel.',
	choices: [
	{
		text: "okay",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		},
	},
	
	]
	},
	
	
]
const confirmation = [
	{
		title: "<strong class = 'color-r'>Confirm</strong>",
	size: "30px",
	index: 0,
	choosetext(bindex){
		this.index = bindex
		this.description = `Are you sure you want to override the contents of save slot ${bindex}?`
	},
	description: 'Are you sure you want to override ${}',
	choices: [
	{
		text: "Yes",
		effect(){
			
			save(confirmation[0].index)
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		},
	},
	{
		text: "No",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		}
	},
	]
	},
	{
		title: "<strong class = 'color-r'>Exit</strong>",
	size: "30px",
	index: 0,
	
	description: 'Are you sure you want to exit to the main menu?',
	choices: [
	{
		text: "Yes",
		effect(){
			
			menu()
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		},
	},
	{
		text: "No",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		}
	},
	]
	},
	{
		title: "<strong class = 'color-r'>Clear</strong>",
	size: "30px",
	index: 0,
	choosetext(index){
		this.index = index
		this.description = `Are you sure you want to delete the contents of save slot ${index}`
	},
	description: 'Are you sure you want to delete the contents of',
	choices: [
	{
		text: "Yes",
		effect(){
			index = confirmation[2].index

			localStorage.removeItem('grid'+index)
			localStorage.removeItem('river'+index)
			localStorage.removeItem('hill'+index)
			localStorage.removeItem('stats'+index)
			localStorage.removeItem('modifiers'+index)
			localStorage.removeItem('population'+index)
			localStorage.removeItem('lockdown'+index)
			localStorage.removeItem('lockdowntimer'+index)
			localStorage.removeItem('slot'+index)
			localStorage.removeItem('difficulty'+index)
			localStorage.removeItem('resources'+index)
			localStorage.removeItem('military'+index)
			localStorage.removeItem('multiply'+index)
			savescreen()
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		},
	},
	{
		text: "No",
		effect(){
			
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		}
	},
	]
	},
	{
		title: "<strong class = 'color-g'>Tutorial</strong>",
	size: "30px",
	index: 0,
	
	description: 'Do you want a tutorial for this game (highly recommended for new players)',
	choices: [
	{
		text: "Yes",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			istutorial = true
			start()
		},
	},
	{
		text: "I've played before",
		effect(){
			
			start()
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			
		}
	},
	]
	},
	]

const popups = [
	
	{
	title: "<strong class = 'color-r'>Enemy Attack</strong>",
	size: "30px",
	description: "A neighbouring tribe is attacking you",
	choosetext(){
		if (resources<difficulty/2){
			choicesdisabled.push(1)
	}
	},
	choices: [
	{
		text: "fight",
		effect(){
			
			
			document.getElementById("popup").style.display = "none"
			attack((difficulty+getRandomInt(-10,5))*3)
		},
	},
	{
		text: "negotiate",
		effect(){
			
			
			document.getElementById("popup").style.display = "none"
			resources-=Math.floor(resources/2)
			displaypopup(12, information)

			displayUI()
		}
	},
	{
		text: "plead",
		effect(){
			
			
			document.getElementById("popup").style.display = "none"
			if (getRandomInt(0,2) == 0){
				displaypopup(4, information)
			}
			else {
				removebuildings()
				displayUI()
				displaypopup(5, information)
			}
		}
	},
	
	]
	},
	
		
			
	
	{
	title: "<strong class = 'color-r'>Revolt</strong>",
	size: "30px",
	description: "The peasants are revolting due to them being unhappy with your rule",
	choosetext(){
		if (resources<difficulty/3){
		choicesdisabled.push(1)
	}
	},
	choices: [
	{
		text: "Punish",
		effect(){
			
			currentpop -=Math.floor(currentpop/3)
			punishamount+=1
			if (punishamount>=5&&!achievements[24].acquired)
			{
				displayachievement(24)
			}
			displayUI()
			displaypopup(3, information)

		}
	}, {
		text: "Bribe",
		effect(){
			
			resources-= Math.floor(resources/3)
			
			displayUI()
			displaypopup(2, information)

		}
		
	}
		]
	},
	{
		title: "<strong class = 'color-g'>Attack</strong>",
		size: "30px",
		description: "The neighbouring tribe looks weak, do we enslave his people or steal their resources",
		choices: [
	{
		text: "Enslave",
		effect(){
			
			if (difficulty-(getRandomInt(1,5)*5) < military){
				currentpop +=Math.floor(currentpop/3)
				displaypopup(7, information)
			}
			else {
				currentpop-= Math.ceil(currentpop/3)
				displaypopup(0, information)
			}
			displayUI()

		}
	}, {
		text: "Steal",
		effect(){
			if (difficulty-getRandomInt(1,5)*5 < military){

			resources+= Math.ceil(resources/3)
			displaypopup(6, information)

			}
			else{
				currentpop-= Math.floor(currentpop/3)
				displaypopup(0, information)
			}
			displayUI()

			

		}
	}
	
		]
	},
	{
	title: "<strong class = 'color-dg'>Plague</strong>",
	size: "30px",
	description: "A faraway traveler stumbles into your village. He claims that a deadly plague wiped out his village and is spreading to yours. Should we lockdown or not",
	choosetext(){},
	choices: [
	{
		text: "Lockdown",
		effect(){
			
			lockdown = true
			displayUI()
			displaypopup(8, information)

		}
	}, {
		text: "Don't",
		effect(){
			
			if (getRandomInt(0,2) == 0){
				displaypopup(10, information)
				
			}
			else{
				currentpop -= Math.floor(currentpop/2)
				displaypopup(9, information)
				}
			
			displayUI()
			

		}
		
	}
		]
	},
	{
	title: "<strong class = 'color-r'>Oh No</strong>",
	size: "30px",
	description: "Seasonal droughts destroyed your food production. <strong class = 'color-r'>-20% food production</strong>",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			modifiers.food-=0.2
			displayUI()
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"

		}
	}, 
		]
	},
	{
		title: "<strong class = 'color-g'>Folklore?</strong>",
	size: "25px",
	description: "A man wearing a silly green hat and a bow strung on his back arrives to your village. He claims that he is Robin Hood steals from the rich and gives to the poor. He askes us for some resources and in exchange we will recieve a great prize. Do we trust him?",
	choosetext(){},
	choices: [
	{
		text:"not",
		effect(){
		displaypopup(18,information)
		currentpop-=Math.floor(currentpop*0.2)
			displayUI()
		}
	},
	{
		text: "give",
		effect(){
			if (achievements[22].acquired==false){displayachievement(22)}
			if (getRandomInt(0,2)==0){
				displaypopup(16,information)
				modifiers.military+=0.4
				resources-=Math.floor(resources*0.4)
			}
			else{
				displaypopup(17,information)
				resources-=Math.floor(resources*0.4)
			}
			displayUI()

		}
	},
	
		]
	},
	{
		title: "<strong class = 'color-r'>Fire</strong>",
	size: "25px",
	description: "A wildfire burnt down a large portion of your village, should we rebuild the burnt buildings?",
	choosetext(){},
	choices: [
	{
		text:"not",
		effect(){
		displaypopup(24,information)
		removebuildings()
		
		}
	},
	{
		text: "rebuild",
		effect(){
		
			information[23].choosetext()
			displaypopup(23, information)
			

		}
	},
	
		]
	},
	{
	title: "<strong class = 'color-r'>Bad Omen</strong>",
	size: "25px",
	description: "A wildfire burnt down a large portion of your village, should we rebuild the burnt buildings?",
	choosetext(){
	choices = [
		"Local sightings reported that a rooster layed an egg",
		"Villagers reported the moon turning red",
		"A random street dweller saw a cow with two heads",
		"A local priest reported their tree leaves turning green",
		
	]
	random = choices[getRandomInt(0,choices.length-1)]
	this.description = `${random}. Our priests notified us and told us it was a bad omen. They ask us to sacrifice our resources to the god above. Should we do it?`
	},
	choices: [
	{
		text:"not",
		effect(){
		luck -=1
		displaypopup(25,information)
		
		}
	},
	{
		text: "sacrifice",
		effect(){
			luck +=1
			resources -=Math.floor(resources/3)
			displaypopup(26, information)
			displayUI()

		}
	},
	
		]
	},
	
	{

	title: "<strong class = 'color-g'>Breakthrough</strong>",
	
	size: "30px",
	description: `A scientific breakthrough in unlocked advanced technology. +30% food production`,
	
	choosetext(){
			choice = [
			{
				type: "food",
				des: "farming"
				
			},
			{
				type: "military",
				des: "weaponery"
			},
			{
				type: 'resource',
				des: "mining"
			}
			]
			random = getRandomInt(0,2)
			this.description = `A scientific breakthrough in ${choice[random].des} unlocked advanced technology. +30% ${choice[random].type} production`
			switch(choice[random].type){
				case 'food':
				modifiers.military+=0.3
				break
				case 'resource':
				modifiers.resources+=0.3
				break
				case 'military':
				modifiers.military+=0.3
				break
				
			}
		},
	choices: [
	{
		text: "close",
		effect(){
			
			displayUI()
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"

		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Traveler</strong>",
	
	size: "30px",
	description: `A scientific breakthrough in unlocked advanced technology. +30% food production`,
	resource: "",
	choosetext(){
			choice = [
			{
				type: "food",
				des: "<strong class = 'color-g'>An agriculture expert</strong>",
				chance: 2
				
			},
			{
				type: "military",
				des: "<strong class = 'color-g'>A famous general</strong>",
				chance: 1,
			},
			{
				type: 'resource',
				des: "<strong class = 'color-g'>An experienced engineer</strong>",
				chance: 3
			},
			{
				type: 'resource',
				des: '<strong class = "color-r">A newbie miner</strong>',
				chance: 4
			},
			{
				type: 'military',
				des: '<strong class = "color-r">A deserted soldier</strong>',
				chance: 5
			},
			]
			random = getRandomInt(0,4)
			this.description = `${choice[random].des} decided to visit your village. He claims that he is from a faraway land of all knowledge. Do we trust him?`
			this.resource = choice[random].type
				
			},
		
	choices: [
	{
		text: "Yes",
		effect(){
			
			if (getRandomInt(1,choice[random].chance)==0){
				information[13].choosetext(choice[random].type)
				displaypopup(13, information)
				switch(choice[random].type){
				case 'food':
				modifiers.food+=0.3
				break
				case 'resource':
				modifiers.resources+=0.3
				break
				case 'military':
				modifiers.military+=0.3
				break
				
			}
			}
			else{
				switch(choice[random].type){
				case 'food':
				modifiers.food-=0.3
				break
				case 'resource':
				modifiers.resources-=0.3
				break
				case 'military':
				modifiers.military-=0.3
				break
				
			}
				information[14].choosetext(choice[random].type)
				displaypopup(14,information)
			}
			displayUI()

		}
	}, 
	{
		text: "No",
		effect(){
			displaypopup(15, information)

		}
	}
		]
		
	},
	
	{
	title: "Refugees",
	size: "30px",
	description: `A group of people stumble into your village. They claim that they are refugees from a distant war and are seeking refuge. Do we let them in or not?`,
	choosetext(){
		this.description = `A group of ${Math.round(currentpop*1.5)} people stumble into your village. They claim that they are refugees from a distant war and are seeking refuge. Do we let them in or not?`
	},
	choices: [
	{
		text: "Let in",
		effect(){
			information[19].choosetext(Math.round(currentpop*1.5))
			currentpop+=Math.round(currentpop*1.5)
			displaypopup(19, information)
			displayUI()


		}
	}, {
		text: "Don't",
		effect(){
			
			displaypopup(20, information)
				
			
			
			displayUI()
			

		}
		
	}
		]
	},
	{
		title: "<strong class = 'color-g'>Trade Offer</strong>",
	size: "30px",
	description: `A mysterious trader scrolls into our village. He presents an offer: if we give him half of our resources, he'll make weapons for us in return. Do we accept his offer?`,
	choosetext(){
		choice = [
		"better weapons",
		"tougher hoes",
		"stronger pickaxes"
		]
		random = getRandomInt(0,2)
		this.description = `A mysterious trader scrolls into our village. He presents an offer: if we give him half of our resources, he'll make ${choice[random]} for us in return. Do we accept his offer?`
		
		if (resources<difficulty/2){
			choicesdisabled.push(0)
		}
		 
		 
	},
	choices: [
	{
		text: "Accept",
		effect(){
		resources-=Math.ceil(resources/2)
		switch(random){
			case 0:
			modifiers.military +=0.5
			break
			case 1:
			modifiers.food +=0.5
			break
			case 2:
			modifiers.resources +=0.5
		}
		information[21].choosetext(random)
		displaypopup(21,information)
		displayUI()
		}
	}, {
		text: "Decline",
		effect(){
			
			displaypopup(22, information)
				
			
			
			displayUI()
			

		}
		
	}
		]
	},
	{
		title: "<strong class = 'color-g'>Trade Route</strong>",
	size: "30px",
	description: "Our scout reports that opportunities for new trade routes have arisen. The Rateddians request. Thersialymoa. Menloms ",
	
	choosetext(){ 
		const upsides = [
		{name: "food", info: "food production", trade(){modifiers.food+=0.3}},
			{name: "resources",info: "resource production", trade(){modifiers.resources+=0.3}},
			{name: "military support",info:"military", trade(){modifiers.military+=0.3}},
			
			
		]
		const downsides = [
			{name: "food", info: "food production", trade(){modifiers.food-=0.3}},
			{name: "resources",info: "resource production", trade(){modifiers.resources-=0.3}},
			{name: "military support",info:"military", trade(){modifiers.military-=0.3}},
			
			
		]
		if (getRandomInt(0,1)==0){
			let placeholder = upsides[1]
			upsides[1] = upsides[0]
			upsides[0]=upsides[2]
			upsides[2]=placeholder
			
		}
		else {
			let placeholder = upsides[1]
			upsides[1] = upsides[2]
			upsides[2]=upsides[0]
			upsides[0]=placeholder
			
		}
		for (i=0;i<3;i++){
			this.choices[i].upside = upsides[i]
			this.choices[i].downside = downsides[i]
		}
		this.description = `Our scout reports that opportunities for new trade routes have arisen.
		 <br>The Rateddians offer ${this.choices[0].upside.name} in exchange for ${this.choices[0].downside.name}.
		 <br>Seymina offers ${this.choices[1].upside.name} in exchange for ${this.choices[1].downside.name}.
		 <br>The Menloms offer ${this.choices[2].upside.name} in exchange for ${this.choices[2].downside.name} `
	},
	choices: [
	{
		upside: 0,
		downside: 0,
		text: "Rateddians",
		effect(){
		this.upside.trade()
		this.downside.trade()
		information[27].choosetext(this.upside.info,this.downside.info)
		displaypopup(27, information)
		displayUI()
		}
	},
	{
		text: "Seymina",
		effect(){
		this.upside.trade()
		this.downside.trade()
		information[27].choosetext(this.upside.info,this.downside.info)
		displaypopup(27, information)
		displayUI()
		}
	},
	{
		text: "Menloms",
		effect(){
		this.upside.trade()
		this.downside.trade()
		information[27].choosetext(this.upside.info,this.downside.info)
		displaypopup(27, information)
		displayUI()
		}
	},
	{
		text: "None",
		effect(){
			
			displaypopup(22, information)
				
			
			
			displayUI()
			

		}
		
	}
		]
	},
	{
		title: "<strong class = 'color-r'>Game Over</strong>",
	size: "30px",
	description: `A mysterious trader scrolls into our village. He presents an offer: if we give him resources, he'll make weapons for us in return. Do we accept his offer?`,
	choosetext(reason){
		switch(reason){
			case "pop":
			this.description= "Your village lays deserted as all of the inhabitants have either abandoned it, or have died. As the final person dies, you realize what this village has become. A prosperous village has now become a ghost town, only a shell of its former self"
			break
			case "res":
			this.description = "The peasants grew restless, as your village ran out of resources. Rumors arose about a seperatist regime looking to urserp the throne. Turns out the rumors were true, as they userped the throne and threw you out. As you walk out exiled, you realize that once a powerful ruler has become a homeless peasant, only shell of your former self"
			break
			case "food":
			this.description = "As the peasants starved, they became restless. One day, they stormed your palace and entered it, killing any guards who dare stand in their way. As they userped the throne, you walk out of the village exiled, only a shell of your former self"
			break
		} 
	},
	choices: [
	{
		text: "Main Menu",
		effect(){
			if (save_slot != null){
			localStorage.removeItem('grid'+save_slot)
			localStorage.removeItem('river'+save_slot)
			localStorage.removeItem('hill'+save_slot)
			localStorage.removeItem('stats'+save_slot)
			localStorage.removeItem('modifiers'+save_slot)
			localStorage.removeItem('population'+save_slot)
			localStorage.removeItem('lockdown'+save_slot)
			localStorage.removeItem('lockdowntimer'+save_slot)
			localStorage.removeItem('slot'+save_slot)
			localStorage.removeItem('difficulty'+save_slot)
			localStorage.removeItem('resources'+save_slot)
			localStorage.removeItem('military'+save_slot)
			localStorage.removeItem('multiply'+save_slot)
			}
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			menu()
		}
	}
	
	
	
	
	
	
	

	]}
]

const information = [
	{
	title: "<strong class = 'color-r'>Failure</strong>",
	size: "30px",
	description: "The enemy defeated you",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
		}]
	},
	{
	title: "<strong class = 'color-g'>Success</strong>",
	size: "30px",
	description: "You defeated the enemy and enslaved their people. +50% population",
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>It's better to keep them happy</strong>",
		size:"25px",
	description: "You bribed them with your resources. -50% resources",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-r'>Let them have it</strong>",
		size: "25px",
	description: "They didn't deserve better rule anyways. -33% population",
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>Success</strong>",
	size: "30px",
	description: "The enemy decided to spare you",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-r'>Failure</strong>",
	size: "30px",
	description: "The enemy decided you were not worth sparing",
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>Success</strong>",
	size: "30px",
	description: "You decimated their village and stole their resources. +33% resources",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"

			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>Success</strong>",
	size: "30px",
	description: "You decimated their village and enslaved their people. +33% population",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "Safty first",
	size: "30px",
	description: "Safty is the first priority. -33% resource and food production",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-r'>Oh No</strong>",
	size: "30px",
	description: "The plague arrived and decimated your people. -50% population",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>Fake News</strong>",
	size: "30px",
	description: "There was no plague after all",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>Lockdown</strong>",
	size: "30px",
	description: "The lockdown has been lifted",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
	title: "<strong class = 'color-g'>War is not for me</strong>",
	size: "30px",
	description: "You negotiated with the enemy. -50% resources",
	choosetext(){},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Knowledge</strong>",
	size: "30px",
	description: "",
	choosetext(resource){
		console.log(resource)
		if (resource != "military"){
		this.description = `The person gave you valuable advice. +33% ${resource} production`
		}
		else{
			this.description = `The person gave you valuable advice. +33% ${resource}`
		}

	},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-r'>Tricked</strong>",
	size: "30px",
	description: "",
	choosetext(resource){
		console.log(resource)
		if (resource != "military"){
		this.description = `The person mislead you. -33% ${resource} production`
		}
		else{
			this.description = `The person mislead you. -33% ${resource}`
		}

	},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Stranger Danger</strong>",
	size: "30px",
	description: "We decided not to trust him",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Benevolent Dictator</strong>",
	size: "30px",
	description: "He thanked you and walked off, next thing you know, your archer's accuracy improved greatly. +40% military, -40% resources",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-r'>Theif</strong>",
	size: "30px",
	description: "He thanked you and ran off, next thing you know, he's selling all of the resources for his own gain. -40% resources",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-r'>Murder!</strong>",
	size: "30px",
	description: "He scoffed at you and ran off, next thing you know, he's out to murder countless civilians. -20% population",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Welcome</strong>",
	size: "30px",
	
	description: "We decided to be nice and let the refugees in. -20% population",
	choosetext(amount){
		this.description = `We decided to be nice and let the refugees in. +${amount} population`
	},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "No space",
	size: "30px",
	
	description: "We told them that we don't have enough room in our village and that they can't come.",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Deal!</strong>",
	size: "30px",
	
	description: "We told him deal and gave him our resources. Moments later he came back with powerful weapons. -50% resources, +50% military",
	choosetext: function(which){
		switch(which){
			case 0:
			this.description = "We told him deal and gave him our resources. Moments later he came back with powerful weapons. -50% resources, +50% military"
			break
			case 1:
			this.description = "We told him deal and gave him our resources. Moments later he came back with shiny new hoes. -50% resources, +50% food production"
			break
			case 2:
			this.description = "We told him deal and gave him our resources. Moments later he came back with stronger pickaxes. -50% resources, +50% resource production"
			break
		}
	},
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>No Deal!</strong>",
	size: "30px",
	
	description: "We told him we're not trading today, and he walked away",
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-g'>Rebuild</strong>",
	size: "30px",
	
	description: `You rebuilt the housing. -${Math.ceil(resources/2)} resources`,
	choosetext(){
		this.description =	`You rebuilt the housing. -${Math.ceil(resources/2)} resources`
	},
	choices: [
	{
		text: "close",
		effect(){
			resources-=Math.ceil(resources/2)
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
			displayUI()
		}
	},
		]
	},
	{
		title: "Money is the best policy",
	size: "30px",
	
	description: `You decided not to rebuild the housing.`,
	
	choices: [
	{
		text: "close",
		effect(){
			
			document.getElementById("popup_block_buttons").style.display = "none"
			document.getElementById("popup").style.display = "none"
		}
	},
		]
	},
	{
		title: "<strong class = 'color-r'>I pray to no god</strong>",
		size: "30px",
	
		description: `You decided not to sacrifice anything. Hopefully the gods above spares you`,
	
		choices: [
		{
			text: "close",
			effect(){
			
				document.getElementById("popup_block_buttons").style.display = "none"
				document.getElementById("popup").style.display = "none"
			}
		},
			]
	},
	{
		title: "<strong class = 'color-r'>Pray to the RNGesus</strong>",
		size: "30px",
	
		description: `You decided to sacrifice anything 33% of your resources. Hopefully the gods above blesses you. -33% resources`,
	
		choices: [
		{
			text: "close",
			effect(){
			
				document.getElementById("popup_block_buttons").style.display = "none"
				document.getElementById("popup").style.display = "none"
			}
		},
			]
	},
	{
		title: "<strong class = 'color-g'>New Routes</strong>",
		size: "30px",
		description: `You decided to sacrifice anything 33% of your resources. Hopefully the gods above blesses you. -33% resources`,
		choosetext(upside, downside){
			this.description = `You decided to open up a new trade route. Hopefully great riches are bestowed upon you. +30% ${upside}, -30% ${downside}`
		},
		
	
		choices: [
		{
			text: "close",
			effect(){
			
				document.getElementById("popup_block_buttons").style.display = "none"
				document.getElementById("popup").style.display = "none"
			}
		},
			]
	},
]


function displaypopup(index, list = popups){
ispainting = false
	document.getElementById("popup_block_buttons").style.display = "block"
	const ele = document.getElementsByClassName("popup_choice")
			while(ele[0]){
				ele[0].parentNode.removeChild(ele[0]);
			}
		
		
		const title = document.getElementById("title")
		const des = document.getElementById("description")
	debugger
	
	
	for (i=0;i<list[index].choices.length;i++){
	
		const grid = document.getElementById("popup")
	const button = document.createElement("button")
	title.innerHTML = list[index].title
	
	des.innerHTML = list[index].description
	title.style.fontSize = list[index].size
	grid.style.display = "grid"
	
	grid.style.gridTemplateColumns=((300/list[index].choices.length).toString() + " ").repeat(list[index].choices.length)
	grid.style.gridTemplateColumns="100 100 100 100"
	button.id = "choice "+i
	button.className = "popup_choice"
	button.style.gridRow="4"
	button.style.gridColumn=(i+1).toString()
	title.style.gridColumn="1 / span "+(list[index].choices.length).toString()
	des.style.gridColumn="1 / span "+(list[index].choices.length).toString()
	let text = document.createTextNode(list[index].choices[i].text)
	button.appendChild(text)
	button.disabled = false
	
	button.addEventListener("click", function(){
		choicesdisabled.length=0;
		list[index].choices[button.id.substr(7)].effect();
		
	})
	grid.appendChild(button)
	if (choicesdisabled.includes(i)){
		button.disabled = true
	}
	}
	
}

function generatehill(){
	
	let y = getRandomInt(1,heightmax-1)
	let height = getRandomInt(5,15)
	y=Math.min(heightmax+y+height,Math.max(1,y-height))
	let x= getRandomInt(8,widthmax-7)
	let width = getRandomInt(3,7)
	let maxx = x+width
	let minx = x-width
	for (i = y; i !=y+height;i++){
		for (let j = minx; j!=maxx;j++){
			if (!rivergrid[i].includes((minx+j)*20)){
				hillgrid[i].push((minx+j)*20)
				if (i==y && getRandomInt(0,1)==0){
					hillgrid[i-1].push((minx+j)*20)
				}
				else if (i==y+height-1 && getRandomInt(0,1)==0){
					hillgrid[i+1].push((minx+j)*20)
				}
			}
			}
			maxx+=getRandomInt(-1,((maxx==widthmax) ? 0:1))
		minx+=getRandomInt(((minx==0) ? 0:-1),1)
		
	}
		
	
}
function generateriver(xpos,ypos, curve, times = 0){
	let x = xpos
	let rivertimes = times
	debugger
	for (let y = ypos;y!=heightmax;y++){
		if (getRandomInt(0+curve,7) > 5){
			rivergrid[y].push(x*20)
			x+=1
			if (getRandomInt(0,5)==0&&rivertimes<3){generateriver(x,y,-5,rivertimes)}
		}
		else if (getRandomInt(3,10-curve) > 5){
			rivergrid[y].push(x*20)
			x-=1
			if (getRandomInt(0,5)==0&&rivertimes<3){generateriver(x,y,5,rivertimes)}
		}
		if (rivergrid[y].includes(x*20)&&y!=ypos){return}
		rivergrid[y].push(x*20)
		
	}
}


function getRandomInt(min, max) {
		min = Math.ceil(min);
		max = Math.floor(max);
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}
function attack(power){
	enemy_power = power
	
	if (enemy_power>military){
		
		
		removebuildings()
		displaypopup(0, information)
		


	
	render()
		return
	}
	currentpop+= Math.ceil(currentpop/2)
	displaypopup(1, information)
}
function removebuildings(){
	currentpop -= Math.floor(currentpop/3);
		
		for(i=gridstats.length-1;i>-1;i--){
		if (getRandomInt(0,2) == 0){
			for (let j = 0; j!=gridstats[i].positions.length;j++){
				grid[gridstats[i].positions[j].y/20].splice(grid[gridstats[i].positions[j].y/20].indexOf(gridstats[i].positions[j].x),1)
			}
			gridstats.splice(i,1)
			buildingamounts[i] -= 1
		}
		
		}
		render()
		displayUI()
}
function isallowed(){
localallowed = false
for (i=0;i!=piece.length;i++){
		
		if((position.x/20)+piece[i].x < 0 || (position.x/20)+piece[i].x > widthmax-1 || (position.y/20)+piece[i].y < 0||(position.y/20)+piece[i].y > heightmax-1){
			return false
			
		}
		
		else if (p.river &&!rivergrid[(position.y/20)+piece[i].y].includes(position.x+piece[i].x*20)){
			return false
		}
		else if (grid[(position.y/20)+piece[i].y].includes(position.x+piece[i].x*20) ||(!p.river&& (rivergrid[(position.y/20)+piece[i].y].includes(position.x+piece[i].x*20)))){
			return false
			
		}
	
		
			
			
			
			if (!first_turn){
				if (grid[(position.y/20)+piece[i].y].includes(20+position.x+piece[i].x*20)){
					localallowed = true
					
				}
				else if (grid[(position.y/20)+piece[i].y].includes(-20+position.x+piece[i].x*20)){
					localallowed = true
					
				}
				else if (grid[(1+position.y/20)+piece[i].y].includes(position.x+piece[i].x*20)){
					localallowed = true
					
				}
				else if (grid[(-1+position.y/20)+piece[i].y].includes(position.x+piece[i].x*20)){
					localallowed = true
					
				}
			
			
			}
			else {
			localallowed = true
			}
			
		}
		if (!localallowed) return false
		if (p.pieceROM[p_index].near != "building"){localallowed = false}
			for (i=0;i!=piece.length;i++){
			
			if (p.pieceROM[p_index].near ==  "river"){
				if (rivergrid[(position.y/20)+piece[i].y].includes(20+position.x+piece[i].x*20)){
					localallowed = true
					break
				}
				else if (rivergrid[(position.y/20)+piece[i].y].includes(-20+position.x+piece[i].x*20)){
					localallowed = true
					break

				}

			}
			if (p.pieceROM[p_index].near == "hill"){
			if (hillgrid[(position.y/20)+piece[i].y].includes(position.x+piece[i].x*20)){
				localallowed = true
				break

			}
			}
			
			}
		return localallowed
}

document.onmousemove = function(event){
		allowed = false
if (ispainting){
	position = {x:(Math.ceil((event.clientX)/20)-1)*20,y:(Math.floor(event.clientY/20)-3)*20}

ctx.beginPath();

render()

	allowed = isallowed()
	
	
		
		for (i=0;i!=piece.length;i++){
			
			ctx.fillText(letter,position.x-(letter.length*4)+10+piece[i].x*20,position.y+10+piece[i].y*20);
			if (!allowed){
				ctx.fillStyle = "rgba(255,0,0,0.5)"
						ctx.fillRect(position.x+piece[i].x*20,position.y+piece[i].y*20,20,20)

			}
			else{		
			
			ctx.rect(position.x+piece[i].x*20,position.y+piece[i].y*20,20,20)
}
		}
ctx.stroke();
}
}
function disable(){
	if (disabling == false){
		disabling = true
	}
	else{
		disabling = false
	}
}
function render(){
	
	ctx.beginPath()
	ctx.clearRect(0,0,screen.width,screen.height)
	ctx.strokeStyle = "rgb(0,0,0)"
					ctx.fillStyle = "rgb(51, 166, 59)"
	ctx.fillRect(0,0, screen.width,screen.height)
	for (i=0;i!=hillgrid.length;i++){
		for (let j = 0; j!=hillgrid[i].length;j++){
			ctx.fillStyle = "rgb(103, 104, 107)"
			ctx.fillRect(hillgrid[i][j],i*20,20,20)
			ctx.fillStyle = "rgb(0,0,0)"
		}
	}		
for (i=0;i!=rivergrid.length;i++){
		for (let j = 0; j!=rivergrid[i].length;j++){
			ctx.fillStyle = "rgb(3,172,252)"
			ctx.fillRect(rivergrid[i][j],i*20,20,20)
			ctx.fillStyle = "rgb(0,0,0)"
		}
	}
	for(i=0;i!=gridstats.length;i++){
		for (let j = 0;j!=gridstats[i].positions.length;j++){
				ctx.fillText(gridstats[i].letter,gridstats[i].positions[j].x+10-gridstats[i].letter.length*4,gridstats[i].positions[j].y+10);
				ctx.rect(gridstats[i].positions[j].x,gridstats[i].positions[j].y,20,20)
		}
	}
	ctx.stroke()
	
	
	ctx.stroke()
}
function start(){
	disableinfo=istutorial
	document.getElementById("popup_block_buttons").style.width = screen.width
	document.getElementById("popup_block_buttons").style.height = screen.height+100
	const ele = document.getElementsByClassName("select-choice")
	for (i=ele.length-1;i>=0;i--){
		ele[i].remove();
	}
	for (i=0;i!=p.pieceROM.length;i++){
	
	const grid = document.getElementById("select-grid")
	const button = document.createElement("button")
	
	button.id = i
	button.className = "select-choice"
	let text = document.createTextNode(p.pieceROM[i].name)
	button.appendChild(text)
	
	button.onclick = function(){select(button.id)}
	grid.appendChild(button)
}
document.body.style.overflow = "hidden"
document.getElementById("difficulty-flex").style.display = 'none'
document.getElementById("info-flex").style.display = 'none'
document.getElementById("achievement-flex").style.display = 'none'
document.getElementById("back_button").hidden = true
document.getElementById("title_start").hidden = true
document.getElementById("stats").style.display = "flex"
document.getElementById("start-flex").style.display = "none"
document.getElementById("market-flex").style.display = "none"
document.getElementById("save-flex").style.display = "none"
document.getElementById("select-grid").style.display = "flex"

displayUI()
render()

if (istutorial&&tutorialindex==0){
continuetutorial(0)
}
}
function next_turn(){
	if (currentpop>population&&istutorial**difficulty==5){
		tutorialindex+=1
		continuetutorial(tutorialindex)
	}
	if (currentpop<1){
		popups[popups.length-1].choosetext("pop")
		displaypopup(popups.length-1)
	}
	else if (resources<3 && resourcesgained<1){
		popups[popups.length-1].choosetext("res")
		displaypopup(popups.length-1)
	}
	else if (food < currentpop/10){
		popups[popups.length-1].choosetext("food")
		displaypopup(popups.length-1)
	}
	if (difficulty>5*difficultymultiplier){
	if ((military<(difficulty-2)*3 && getRandomInt(1,3)==1) || getRandomInt(0,7)==0){
		popups[0].choosetext()

		displaypopup(0)

	}
	else if (getRandomInt(0,Math.max(0,(3-Math.max(-7,currentpop-population))*Math.min(3-difficultymultiplier,food/currentpop))) == 0){
		popups[1].choosetext()
		displaypopup(1)
				


	}
	else if (getRandomInt(0,1) > 0){
		if (getRandomInt(0,15+luck)<5*difficultymultiplier){
		randomindex = getRandomInt(3,7)
				popups[randomindex].choosetext()
				displaypopup(randomindex)
		}
		else{
				randomindex = getRandomInt(8,12)
				popups[randomindex].choosetext()
				displaypopup(randomindex)

		}
	}
	else if (military>(difficulty+1)*5){
		displaypopup(2)
		}
	
	
	}
	
	if (lockdown) {
		lockdowntimer+=1
		if (lockdowntimer ==5){
			lockdown==false
			displaypopup(11,information)
		}
		}


	

	currentpop+=Math.max(-2-Math.ceil(currentpop/5),Math.min(1+Math.ceil(currentpop/5),food-currentpop))
	resources+=resourcesgained
	difficulty+=Math.round((1+Math.floor(difficulty/20))*Math.min(1.5,difficultymultiplier))
	displayUI()
	if (tutorialindex == 3){
		tutorialindex+=1
		continuetutorial(tutorialindex)
	}
}
function select(index){
	disabling = false
		piece = []
	p.river = false
	for (i=0;i!=p.pieceROM[index].piecepositions.length;i++){
	piece.push(p.pieceROM[index].piecepositions[i])
	
	}
	if (p.pieceROM[index].name == "Bridge"){
		p.river = true
	}
	
	
	letter = p.pieceROM[index].letter
	p_index = index
	ispainting = true
	
}
function cancel(){
	piece = []
	ispainting = false
	render()
}
document.onmousedown = function(event){
	
	if (ispainting && allowed&&position.y<canvas.height){
	
		p.population = 0
		p.military = 0
		p.resources = 0
		p.food = 0
		oldpop = unemployed
		gridposition = []
		p.pieceROM[p_index].effect()
		
		for (i=0;i!=piece.length;i++){
		gridposition.push({x:position.x+piece[i].x*20,y:position.y+piece[i].y*20})
		grid[(position.y/20+piece[i].y)].push(position.x+piece[i].x*20)
		
		
		}
		
		
		ishill = true
		if (p.hill){
			for (i=0;i!=gridposition.length;i++){
				if (!hillgrid[gridposition[i].y/20].includes(gridposition[i].x)){
					ishill = false
				}
			}
		}
		else{ishill = false}
		gridstats.push({
			letter:letter,
			population:p.population,
			employmentrequired: oldpop-unemployed,
			food:p.food,
			resources:p.resources,
			military:p.military*(ishill ? 2:1),
			positions:gridposition
		
		})
		first_turn = false
		allowed = false
		if (!p.pieceROM[p_index].requires()){
			piece = []
			ispainting = false
			allowed = false
		}
		buildingamounts[p_index] +=1
		
		displayUI()
		if (tutorialindex==1||tutorialindex==2){
			tutorialindex+=1
			continuetutorial(tutorialindex)
		}
	}
	
}
//document.onkeydown = function(event){
	//switch (event.key){
	//	case "r":
		
		//rotate()
		//render()
		//break
	//}
//}
function displayUI(){
	
		population = 0
		food = 0
		military = 0
		resourcesgained = 0
		unemployed = currentpop
		const ele = document.getElementsByClassName("select-choice")
		if (disableinfo){
			for (const el of document.getElementsByClassName("info")){
				el.disabled = true
			}
		}
		else {
		for (const el of document.getElementsByClassName("info")){
				el.disabled = false
			}
		}
		for (i=0;i<gridstats.length;i++){
			if (unemployed>=gridstats[i].employmentrequired){
			population += gridstats[i].population
			food += gridstats[i].food
			military += gridstats[i].military
			resourcesgained += gridstats[i].resources
			unemployed -= gridstats[i].employmentrequired
			}
			else{
				for (let j = 0; j!=gridstats[i].positions.length;j++){
				grid[gridstats[i].positions[j].y/20].splice(grid[gridstats[i].positions[j].y/20].indexOf(gridstats[i].positions[j].x),1)
			}
			gridstats.splice(i,1)
			}
			
		}
		if (lockdown){
			resourcesgained -= Math.floor(resourcesgained/2)
			food -= Math.floor(food/2)
			
		}
		food += Math.floor(food*modifiers.food)
		resourcesgained += Math.floor(resourcesgained*modifiers.resources)
		military += Math.floor(military*modifiers.military)
		
		i = 0
		
		for (const el of ele){
			if (!p.pieceROM[i].requires()){
			el.disabled = true;
			
			}
			else{el.disabled = false}
			i++
			
		}
		
		
		military+=unemployed
		for (i=0;i<achievements.length;i++){
			if (achievements[i].requires()&&achievements[i].acquired==false){
			
			displayachievement(i)			
				
			}
			
		}
		document.getElementById("pop").innerHTML = "Population: " + currentpop+"/"+(currentpop>population&&difficulty>5*difficultymultiplier ? "<strong class = 'color-r'>"+population+"</strong>":population)
		document.getElementById("food").innerHTML = "Food: " + (food<currentpop ? "<strong class = 'color-r'>"+food+"</strong>": food)
		document.getElementById("power").innerHTML = "Military: " + military
		document.getElementById("unemployed").innerHTML = "Unemployed People: " + unemployed
		document.getElementById("resources").innerHTML = "Resources: " + resources
}
function displayachievement(which){
	debugger
	achievements[which].acquired = true
	acquired[which] = true
	localStorage.setItem("achievements", JSON.stringify(acquired))
	animationac = document.getElementById("unlocked")
				
				
	animationac.style.display = "flex"
	document.getElementById("achievementname").innerHTML = achievements[which].title
	animationac.style.animation = 'none';
		animationac.offsetHeight; /* trigger reflow */
		animationac.style.animation = null; 
}
function rotate(){
	difference +=0.5
	let x = []
	let y = []
	for (i=0;i!=piece.length;i++){
		x.push(piece[i].x)
		y.push(piece[i].y)
		
	}
	let max = Math.max(...x)
	let min = Math.min(...x)
	let miny = Math.min(...y)
	let maxy = Math.max(...y)
	midpoint = {x:(min+max)/2,y:(miny+maxy)/2}
	
	
	for(i=0;i<piece.length;i++){
		piece[i].x-=midpoint.x
		piece[i].y-=midpoint.y

		oldy = piece[i].y
		piece[i].y = piece[i].x*-1
		piece[i].x = oldy
		piece[i].x+=midpoint.x
		piece[i].y+=midpoint.y
		piece[i].x = Math.floor(piece[i].x)
		piece[i].y = Math.floor(piece[i].y)
		if (Math.floor(difference) == 1){
			piece[i].x +=1
			piece[i].y +=1
		}
	}
			if (Math.floor(difference) == 1){
				difference = 0
			}

}
</script>